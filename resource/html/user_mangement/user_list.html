<!DOCTYPE html>
<html lang="ZH-cn" data-identity="2">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0,minimum-scale=1, maximum-scale=1, user-scalable=no">
    <title>用户列表</title>

    <link rel="stylesheet" href="../../assets/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="../../assets/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="../../assets/css/cmui.min.css"/>
    <link rel="stylesheet" href="../../assets/css/base.min.css"/>
    <link rel="stylesheet" href="../../assets/css/innerbase.min.css"/>

    <!--[if lt IE 9]>
    <script src="../../assets/lib/html5shiv.js"></script>
    <script src="../../assets/lib/respond.min.js"></script>
    <![endif]-->
    <style>
        .table td a {
            padding: 0 3px;
        }

        .table label {
            font-weight: 400;
            margin-bottom: 0;
        }

        .resume .choose span {
            margin-right: 0;
        }

        /*弹窗   start*/
        .dialog-sm .width_480 {
            width: 480px;
        }

        .modal-body .content {
            max-height: 150px;
            overflow: auto;
        }

        .user-list p {
            display: inline-block;
            border: 1px solid #91b2fc;
            height: 28px;
            line-height: 28px;
            padding: 0 9px;
            margin-right: 12px;
            font-size: 12px;
        }

        .form-control {
            display: inline-block;
            width: 290px;
        }

        p.red {
            font-size: 12px;
            color: #ff5021;
        }

        h5.modal-title {
            font-size: 16px;
            color: #666;
        }

        .modal-content p {
            margin-bottom: 12px;
        }

        /*弹窗     end*/
    </style>
</head>
<body>
<div class="main-container">
    <ol class="breadcrumb">
        <li>用户管理</li>
        <li>用户列表</li>
    </ol>
    <div class="">
        <div class="module-header"><h4>用户账户列表<a href="user_new.html" class="btn-blue w80 pull-right">创建用户</a></h4></div>
        <div class="tile-content mt-10">
            <div class="table-responsive resume">
                <table id="list" class="table table-indent text-center table-bordered-noheader">
                    <thead>
                    <tr>
                        <!--<th><label><input id="all" type="checkbox" value="">全选</label></th>-->
                        <th><label class="choose"><span id="all"></span>全选</label></th>
                        <th>账户名称</th>
                        <th>公司</th>
                        <th>权限分配</th>
                        <th>状态</th>
                        <th>最近在线</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody id="itemContainer">
                    <tr data-id="1">
                        <td class="choose"><label><span></span>1</label></td>
                        <td>jituan-furong1</td>
                        <td>北京</td>
                        <td>用户组1</td>
                        <td>已启用</td>
                        <td>2016.07.18</td>
                        <td><a href="user_detail.html">查看</a><a href="user_edit.html">修改</a></td>
                    </tr>
                    <tr data-id="2">
                        <td class="choose"><label><span></span>2</label></td>
                        <td>beijing-chengjuan2</td>
                        <td>未填写</td>
                        <td>用户组2</td>
                        <td>已禁用</td>
                        <td>2016.07.18</td>
                        <td><a href="#">查看</a><a href="#">修改</a></td>
                    </tr>
                    <tr data-id="3">
                        <td class="choose"><label><span></span>3</label></td>
                        <td>jituan-furong3</td>
                        <td>山东</td>
                        <td>未分配</td>
                        <td>已启用</td>
                        <td>当前在线</td>
                        <td><a href="#">查看</a><a href="#">修改</a></td>
                    </tr>
                    <tr data-id="4">
                        <td class="choose"><label><span></span>4</label></td>
                        <td>jituan-furong4</td>
                        <td>运营集团</td>
                        <td>用户组3</td>
                        <td>已启用</td>
                        <td>2016.07.18</td>
                        <td><a href="#">查看</a><a href="#">修改</a></td>
                    </tr>
                    <tr data-id="5">
                        <td class="choose"><label><span></span>1</label></td>
                        <td>jituan-furong5</td>
                        <td>北京</td>
                        <td>用户组1</td>
                        <td>已启用</td>
                        <td>2016.07.18</td>
                        <td><a href="#">查看</a><a href="#">修改</a></td>
                    </tr>
                    <tr data-id="6">
                        <td class="choose"><label><span></span>2</label></td>
                        <td>beijing-chengjuan6</td>
                        <td>未填写</td>
                        <td>用户组2</td>
                        <td>已禁用</td>
                        <td>2016.07.18</td>
                        <td><a href="#">查看</a><a href="#">修改</a></td>
                    </tr>
                    <tr data-id="7">
                        <td class="choose"><label><span></span>3</label></td>
                        <td>jituan-furong7</td>
                        <td>山东</td>
                        <td>未分配</td>
                        <td>已启用</td>
                        <td>当前在线</td>
                        <td><a href="#">查看</a><a href="#">修改</a></td>
                    </tr>
                    <tr data-id="8">
                        <td class="choose"><label><span></span>4</label></td>
                        <td>jituan-furong8</td>
                        <td>运营集团</td>
                        <td>用户组3</td>
                        <td>已启用</td>
                        <td>2016.07.18</td>
                        <td><a href="#">查看</a><a href="#">修改</a></td>
                    </tr>
                    <tr data-id="9">
                        <td class="choose"><label><span></span>1</label></td>
                        <td>jituan-furong9</td>
                        <td>北京</td>
                        <td>用户组1</td>
                        <td>已启用</td>
                        <td>2016.07.18</td>
                        <td><a href="#">查看</a><a href="#">修改</a></td>
                    </tr>
                    <tr data-id="10">
                        <td class="choose"><label><span></span>2</label></td>
                        <td>beijing-chengjuan10</td>
                        <td>未填写</td>
                        <td>用户组2</td>
                        <td>已禁用</td>
                        <td>2016.07.18</td>
                        <td><a href="#">查看</a><a href="#">修改</a></td>
                    </tr>
                    <tr data-id="11">
                        <td class="choose"><label><span></span>3</label></td>
                        <td>jituan-furong11</td>
                        <td>山东</td>
                        <td>未分配</td>
                        <td>已启用</td>
                        <td>当前在线</td>
                        <td><a href="#">查看</a><a href="#">修改</a></td>
                    </tr>
                    <tr data-id="12">
                        <td class="choose"><label><span></span>4</label></td>
                        <td>jituan-furong12</td>
                        <td>运营集团</td>
                        <td>用户组3</td>
                        <td>已启用</td>
                        <td>2016.07.18</td>
                        <td><a href="#">查看</a><a href="#">修改</a></td>
                    </tr>
                    <tr data-id="13">
                        <td class="choose"><label><span></span>1</label></td>
                        <td>jituan-furong13</td>
                        <td>北京</td>
                        <td>用户组1</td>
                        <td>已启用</td>
                        <td>2016.07.18</td>
                        <td><a href="#">查看</a><a href="#">修改</a></td>
                    </tr>
                    <tr data-id="14">
                        <td class="choose"><label><span></span>2</label></td>
                        <td>beijing-chengjuan14</td>
                        <td>未填写</td>
                        <td>用户组2</td>
                        <td>已禁用</td>
                        <td>2016.07.18</td>
                        <td><a href="#">查看</a><a href="#">修改</a></td>
                    </tr>
                    <tr data-id="15">
                        <td class="choose"><label><span></span>3</label></td>
                        <td>jituan-furong15</td>
                        <td>山东</td>
                        <td>未分配</td>
                        <td>已启用</td>
                        <td>当前在线</td>
                        <td><a href="#">查看</a><a href="#">修改</a></td>
                    </tr>
                    <tr data-id="16">
                        <td class="choose"><label><span></span>4</label></td>
                        <td>jituan-furong16</td>
                        <td>运营集团</td>
                        <td>用户组3</td>
                        <td>已启用</td>
                        <td>2016.07.18</td>
                        <td><a href="#">查看</a><a href="#">修改</a></td>
                    </tr>
                    </tbody>
                </table>
                <p class="text-info" style="display: none;">已选中<span>xxx</span>条记录</p>
                <div>
                    <button class="btn-default w80" id="used" data-type="on">启用</button>
                    <button class="btn-default w80" id="useabled" data-type="off">禁用</button>
                    <a class="btn-default w80" href="#" data-target="" data-toggle="modal" id="empower">赋权</a>
                </div>
            </div>
            <div class="data-page text-center page">
                <div class="holder pagination" id="pagination1"></div>
            </div>

            <!--赋值弹窗      start-->
            <div class="modal fade dialog-sm" id="assignment" data-backdrop="static">
                <div class="modal-dialog width_480">
                    <div class="modal-content bd-muted">
                        <div class="modal-header bg-muted bd-muted">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                    aria-hidden="true">&times;</span></button>
                            <h5 class="modal-title text-left">分配权限</h5>
                        </div>
                        <div class="modal-body">
                            <p class="text-left">已选择<span class="num">10</span>个用户：</p>
                            <div class="form-group user-list text-left content">

                            </div>
                            <div class="text-left form-group">
                                批量设置权限：
                                <select name="" class="form-control" id="team">
                                    <option value="未分配">未分配</option>
                                    <option value="用户组1">用户组1</option>
                                    <option value="用户组2">用户组2</option>
                                    <option value="用户组3">用户组3</option>
                                    <option value="用户组4">用户组4</option>
                                </select>
                            </div>
                            <p class="red text-left">如果您发现没有合适的权限，请先去创建权限再批量进行批量操作。</p>
                            <p class="red text-align" id="return"></p>
                            <!--<p class="red text-align" id="return">设置成功!</p>-->
                            <div>
                                <button class="btn-blue w80" id="sure">确定</button>
                                <button class="btn-default w80" data-dismiss="modal">取消</button>
                            </div>
                        </div>

                    </div><!-- /.modal-content -->
                </div><!-- /.modal-dialog -->
            </div>
            <!--赋值弹窗     end-->
        </div>
    </div>
</div>

<script src="../../assets/lib/require.js"></script>
<script src="../../assets/js/config.js"></script>
<script>
    require(["common", "bootstrap", "jqPaginator"], function () {

//	var checkSpan =$('.choose span');
//	for(var j=0;j<checkSpan.length;j++){
//		$(checkSpan[j]).click(function(){
//			if(this.className==''){
//				$(this).addClass('current');
//			}else{
//				$(this).removeClass('current');
//			}
//		})
//	}
//	全选   start
        var s = $('thead span').attr('class');
        checklis();

        check();

        $('#used').click(function () {
            seedAx('已启用', 'on');
        })
        $('#useabled').click(function () {
            seedAx('已禁用', 'off');
        })
        $('#empower').click(function () {
            var k = $('tbody .current');
            var num = $('.num');
            var con = $('.content');
            $(con).html('');
            if (k.length) {
                $('#empower').attr('data-target', '#assignment');
                $(num).text(k.length);
                for (var i = 0; i < k.length; i++) {
                    var p = "<p>" + $(k[i]).parents('tr').find('td:eq(1)').html() + "</p>"
                    $(con).append(p)

                }
            } else {
                $('#empower').attr('data-target', '');
            }
        });

        //传输数据
        $('#sure').click(function () {
            var arr = [];
            var k = $('tbody .current');
            var option = $('#team option').val();
            for (var j = 0; j < k.length; j++) {
                arr.push($(k).eq(j).parents('tr').data('id'));
            }
            if (arr.length > 0) {
                $.ajax({
                    url: '#',
                    type: 'post',
                    data: {checkIds: arr, subGroup: option},
                    dataType: 'json',
                    success: function (data) {
                        //console.log(arr)
                        //$(k).parents('tr').find('td:eq(4)').html(use);
                        if (data.flag) {
                            $('#return').html("设置成功!");
                            //$(k).parents('tr').find('td:eq(4)').html(use);
                            //setTimeout(function(){$('#assignment').modal('hide')},1000);
                            setTimeout(function () {
                                window.location.reload()
                            }, 500)
                        } else {
                            $('#return').html("设置失败，Error Code：XXXXX")
                        }
//						$(k).parents('tr').find('td:eq(4)').html(use);
                    }
                });
            }


        })

        //  分页  start
        var totalPages = 4;
        if (totalPages == 0) {
            var html = "<p class='no-show mt-20'>没有搜到符合的项目</p>";
            $('#itemContainer').append(html);
        } else {
            $.jqPaginator('#pagination1', {
                totalPages: totalPages,
                visiblePages: 5,
                currentPage: 1,
                onPageChange: function (n) {
                    /* location.href = '${ctx}/raisestRaiseProject?industry='+$("[name='industry'] :selected").val()
                     +'&supportSort='+$("[name='supportSort'] :selected").val()
                     +'&moneySort='+$("[name='moneySort'] :selected").val()
                     +'&pageNum=' + n;  */
//						$("[name='pageNum']").val(n);
//						$("#search_form").submit();
                }
            });
        }
//	 分页   end
    });

    function checklis() {
        $('#all').click(function () {
            var status = $(this).attr('class');
            if (!status) {
                $(this).addClass('current');
                $('tbody tr span').addClass('current');
                $('.text-info').css('display', 'block')
                $('.text-info span').html($('tbody tr span').length)
            } else {
                $(this).removeClass('current');
                $('tbody tr span').removeClass('current');
                $('.text-info').css('display', 'none')
            }
        });

        $('tbody').delegate('tr span', 'click', function () {
            var status = $(this).attr('class');
            if (!status) {//如果为假，直接checkall勾去掉
                $('#all').attr('class', status);
            } else {
                var allChecked = isAllChecked($('tbody tr span'));
                $('#all').attr('class', allChecked);
            }
        });
    }

    function isAllChecked($inputs) {
        var result = 'current';

        for (var i = 0, j = $inputs.length; i < j; i++) {
            if (!$inputs.eq(i).attr('class')) {
                result = '';
                break;
            }
        }
        return result;
    }
    //	全选   end

    //	显示选中条目   start
    function check() {
        var intLen = $('tbody span');
        console.log(intLen.length)
        for (var i = 0; i < intLen.length; i++) {
            $(intLen[i]).click(function () {
                var k = $('tbody .current');
                if ($(this).attr("class") == 'current') {
                    $(this).removeClass('current');
                    $('#empower').attr('data-target', '');
                    if (k.length > 1) {
                        $('.text-info span').html(k.length - 1)
                    } else {
                        $('.text-info').css('display', 'none')
                    }
                } else {
                    $(this).addClass('current');
                    $('.text-info').css('display', 'block')
                    $('.text-info span').html(k.length + 1)

                }

            })
        }
    }

    function seedAx(use, type) {
        var arr = [];
        var k = $('tbody .current');
        for (var j = 0; j < k.length; j++) {
            arr.push($(k).eq(j).parents('tr').data('id'));
        }
        if (arr.length > 0) {
            $.ajax({
                url: '#',
                type: 'post',
                data: {checkIds: arr},
                dataType: 'json',
                success: function (data) {
                    if (data.flag) {
                        window.location.reload();
                        if (type == 'on') {
                            alert('账户已启用');
                        } else {
                            alert('账户已禁用');
                        }
                        //$(k).parents('tr').find('td:eq(4)').html(use);
                    } else {
                        alert('操作失败：Error CodeXXXX');
                    }
                }
            })
        }

    }
</script>

</body>
</html>