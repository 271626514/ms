<!DOCTYPE html>
<html lang="ZH-cn" data-identity="102">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0,minimum-scale=1, maximum-scale=1, user-scalable=no">
    <title>查看经费流水</title>
    <link rel="stylesheet" href="../../assets/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="../../assets/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="../../assets/css/cmui.min.css"/>
    <link rel="stylesheet" href="../../assets/css/base.min.css"/>
    <link rel="stylesheet" href="../../assets/css/innerbase.min.css"/>

    <!--[if lt IE 9]>
    <script src="../../assets/lib/html5shiv.js"></script>
    <script src="../../assets/lib/respond.min.js"></script>
    <![endif]-->
    <style>
        .module-header h4 {
            border-bottom: 2px solid #eceff9;
            padding-bottom: 16px;
        }

        .searchTitle {
            font-size: 14px;
            color: #999;
        }

        .table thead tr {
            height: 40px;
        }

        .table > thead > tr > th {
            line-height: 24px;
        }

        .table-indent th:first-child, .table-indent tr > td:first-child {
            text-indent: 0;
        }

        .table > tbody > tr > td.green {
            color: #5dd599;
        }

        .table > tbody > tr > td.gray {
            color: #999;
        }

        .table td a {
            padding: 0 3px;
        }

        .table label {
            font-weight: 400;
        }

        .module-header h4 {
            border-bottom: 2px solid #eceff9;
            padding-bottom: 16px;
        }

        .form-bg {
            padding: 15px 0;
            background: #f6f7fb;
        }

        .form input.white-bg[type=text] {
            background: #fff;
        }

        .red {
            color: #ff5021;
        }
    </style>
</head>
<body>
<div class="main-container">
    <ol class="breadcrumb">
        <li>资源管理</li>
        <li>经费管理</li>
        <li>查看经费流水</li>
    </ol>
    <div class="">
        <div class="module-header">
            <h4>经费管理</h4>
        </div>
        <form class="form">
            <div class="tile-content mt-20">
                <div class="table-responsive">
                    <table class="table table-indent">
                        <tbody>
                        <tr>
                            <td>项目ID：1234567890</td>
                            <td>项目名称：大镖师</td>
                            <td>经费上限：80,000元</td>
                            <td>经费余额：40,000元</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <p class="searchTitle">总计 <span class="red">41</span> 条符合条件的纪录，本页显示 第 <span class="red">1-20</span> 条条数据</p>
            <div class="tile-content">
                <div class="table-responsive">
                    <table class="table table-indent text-center table-bordered-noheader">
                        <thead>
                        <tr>
                            <th>时间</th>
                            <th>类别一</th>
                            <th>类别二</th>
                            <th>明细／详情</th>
                            <th>金额</th>
                            <th>操作人</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>2016-07-09 12:36</td>
                            <td>增加</td>
                            <td>空间服务</td>
                            <td>按项目团队请求追加2000元</td>
                            <td>＋2,000</td>
                            <td>si jia qing001/司家庆</td>
                        </tr>
                        <tr>
                            <td>2016-07-09 12:36</td>
                            <td>增加</td>
                            <td>空间服务</td>
                            <td>工位：5个</td>
                            <td>-2,000</td>
                            <td>si jia qing001/司家庆</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="data-page text-center page">
                    <div class="holder pagination" id="pagination"></div>
                </div>
            </div>
        </form>
    </div>
</div>

<script src="../../assets/lib/require.js"></script>
<script src="../../assets/js/config.js"></script>
<script>
    require(["common", "bootstrap", "jqPaginator"], function () {
        //	分页 start
        var totalPages = 4;
        if (totalPages == 0) {
            var html = "<p class='no-show mt-20'>没有搜到符合的项目</p>";
            $('#itemContainer').append(html);
        } else {
            $.jqPaginator('#pagination', {
                totalPages: totalPages,
                visiblePages: 5,
                currentPage: 1,
                onPageChange: function (n) {
                    /* location.href = '${ctx}/raisestRaiseProject?industry='+$("[name='industry'] :selected").val()
                     +'&supportSort='+$("[name='supportSort'] :selected").val()
                     +'&moneySort='+$("[name='moneySort'] :selected").val()
                     +'&pageNum=' + n;  */
                    //						$("[name='pageNum']").val(n);
                    //						$("#search_form").submit();
                }
            });
        }
        //	分页 end

//	var checkSpan =$('.choose span');
//	for(var j=0;j<checkSpan.length;j++){
//		$(checkSpan[j]).click(function(){
//			if(this.className==''){
//				$(this).addClass('current');
//			}else{
//				$(this).removeClass('current');
//			}
//		})
//	}
//	全选   start
        var s = $('thead span').attr('class');
        checklis();

        check();

        $('#used').click(function () {
            seedAx('已启用', 'on');
        })
        $('#useabled').click(function () {
            seedAx('已禁用', 'off');
        })
        $('#empower').click(function () {
            var k = $('tbody .current');
            var num = $('.num');
            var con = $('.content');
            $(con).html('');
            if (k.length) {
                $('#empower').attr('data-target', '#assignment');
                $(num).text(k.length);
                for (var i = 0; i < k.length; i++) {
                    var p = "<p>" + $(k[i]).parents('tr').find('td:eq(1)').html() + "</p>"
                    $(con).append(p)

                }
            } else {
                $('#empower').attr('data-target', '');
            }
        });

        //传输数据
        $('#sure').click(function () {
            var arr = [];
            var k = $('tbody .current');
            var option = $('#team option').val();
            for (var j = 0; j < k.length; j++) {
                arr.push($(k).eq(j).parents('tr').data('id'));
            }
            if (arr.length > 0) {
                $.ajax({
                    url: '#',
                    type: 'post',
                    data: {checkIds: arr, subGroup: option},
                    dataType: 'json',
                    success: function (data) {
                        //console.log(arr)
                        //$(k).parents('tr').find('td:eq(4)').html(use);
                        if (data.flag) {
                            $('#return').html("设置成功!");
                            //$(k).parents('tr').find('td:eq(4)').html(use);
                            //setTimeout(function(){$('#assignment').modal('hide')},1000);
                            setTimeout(function () {
                                window.location.reload()
                            }, 500)
                        } else {
                            $('#return').html("设置失败，Error Code：XXXXX")
                        }
//						$(k).parents('tr').find('td:eq(4)').html(use);
                    }
                });
            }


        })


    });

    function checklis() {
        $('#all').click(function () {
            var status = $(this).attr('class');
            if (!status) {
                $(this).addClass('current');
                $('tbody tr span').addClass('current');
                $('.text-info').css('display', 'block')
                $('.text-info span').html($('tbody tr span').length)
            } else {
                $(this).removeClass('current');
                $('tbody tr span').removeClass('current');
                $('.text-info').css('display', 'none')
            }
        });

        $('tbody').delegate('tr span', 'click', function () {
            var status = $(this).attr('class');
            if (!status) {//如果为假，直接checkall勾去掉
                $('#all').attr('class', status);
            } else {
                var allChecked = isAllChecked($('tbody tr span'));
                $('#all').attr('class', allChecked);
            }
        });
    }

    function isAllChecked($inputs) {
        var result = 'current';

        for (var i = 0, j = $inputs.length; i < j; i++) {
            if (!$inputs.eq(i).attr('class')) {
                result = '';
                break;
            }
        }
        return result;
    }
    //	全选   end

    //	显示选中条目   start
    function check() {
        var intLen = $('tbody span');
        console.log(intLen.length)
        for (var i = 0; i < intLen.length; i++) {
            $(intLen[i]).click(function () {
                var k = $('tbody .current');
                if ($(this).attr("class") == 'current') {
                    $(this).removeClass('current');
                    $('#empower').attr('data-target', '');
                    if (k.length > 1) {
                        $('.text-info span').html(k.length - 1)
                    } else {
                        $('.text-info').css('display', 'none')
                    }
                } else {
                    $(this).addClass('current');
                    $('.text-info').css('display', 'block')
                    $('.text-info span').html(k.length + 1)

                }

            })
        }
    }

    function seedAx(use, type) {
        var arr = [];
        var k = $('tbody .current');
        for (var j = 0; j < k.length; j++) {
            arr.push($(k).eq(j).parents('tr').data('id'));
        }
        if (arr.length > 0) {
            $.ajax({
                url: '#',
                type: 'post',
                data: {checkIds: arr},
                dataType: 'json',
                success: function (data) {
                    if (data.flag) {
                        window.location.reload();
                        if (type == 'on') {
                            alert('账户已启用');
                        } else {
                            alert('账户已禁用');
                        }
                        //$(k).parents('tr').find('td:eq(4)').html(use);
                    } else {
                        alert('操作失败：Error CodeXXXX');
                    }
                }
            })
        }

    }
</script>

</body>
</html>